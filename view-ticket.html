<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Delta Silence • View Ticket</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0d10; --panel:#12151a; --muted:#9aa3ad; --border:#1e2228; --accent:#00bcd4;
    --ok:#00d38a; --err:#ff8b8b; --radius:16px; --shadow:0 18px 40px rgba(0,0,0,.55);
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    background: radial-gradient(1200px 700px at 50% -250px,#16202a,#0b0d10);
    color:#fff; font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; font-weight:800;
    padding:24px;
  }
  .wrap{
    width:100%; max-width:760px; background:linear-gradient(180deg,#151a22 0%,#12151a 100%);
    border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:26px;
  }
  h1{margin:0 0 6px; font-size:clamp(1.6rem,3.2vw,2.3rem)}
  p.sub{margin:0 0 18px; color:var(--muted); font-weight:700; font-size:.95rem}
  form{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px}
  input{
    flex:1 1 320px; border:1px solid var(--border); background:#0f1318; color:#dfe6ee;
    border-radius:12px; padding:12px 14px; font-weight:700;
  }
  .btn{
    display:inline-block; padding:12px 16px; border-radius:12px;
    background:var(--accent); color:#00222a; border:none; cursor:pointer;
    font-weight:900; letter-spacing:.3px;
  }
  .btn:hover{filter:brightness(1.08)}
  .btn-ghost{
    display:inline-block; padding:10px 14px; border-radius:12px;
    background:#0f1318; color:#cfd6de; border:1px solid var(--border); cursor:pointer;
    font-weight:900;
  }
  .btn-ghost:hover{border-color:var(--accent); color:#fff}
  .note{color:var(--muted); font-size:.85rem; margin-top:8px}
  .ok{color:var(--ok)}
  .err{color:var(--err)}

  .ticket{
    margin-top:14px; padding:16px; border:1px solid var(--border); border-radius:12px; background:#0f1318;
  }
  .row{display:grid; grid-template-columns:180px 1fr; gap:10px; padding:8px 0; border-bottom:1px dashed #1a2230}
  .row:last-child{border-bottom:0}
  .label{color:#aab3bd}
  .value{color:#e7edf5; word-wrap:break-word; white-space:pre-wrap}
  .top-actions{display:flex; gap:8px; flex-wrap:wrap; margin-top:12px}
  .spacer{height:8px}
  .links{margin-top:14px}
  .links a{color:#7dd3fc; text-decoration:underline}
  @media print{
    body{background:#fff; color:#000; font-weight:600}
    .wrap{box-shadow:none; border:0}
    .btn,.btn-ghost,.links,.note{display:none}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>View Ticket</h1>
    <p class="sub">Enter your Authorization Key to view your ticket. Only the exact key can open it.</p>

    <form onsubmit="lookup(event)">
      <input id="key" placeholder="TCK-XXXX-XXXX" required>
      <button class="btn" type="submit">Open</button>
      <button class="btn-ghost" type="button" onclick="pasteFromClipboard()">Paste</button>
    </form>

    <div id="msg" class="note"></div>

    <div id="ticket" class="ticket" style="display:none">
      <div class="row"><div class="label">Authorization Key</div><div class="value" id="v_key"></div></div>
      <div class="row"><div class="label">Status</div><div class="value" id="v_status"></div></div>
      <div class="row"><div class="label">Created</div><div class="value" id="v_created"></div></div>
      <div class="row"><div class="label">Topic</div><div class="value" id="v_topic"></div></div>
      <div class="row"><div class="label">Username</div><div class="value" id="v_user"></div></div>
      <div class="row"><div class="label">Subject</div><div class="value" id="v_subject"></div></div>
      <div class="row"><div class="label">Description</div><div class="value" id="v_desc"></div></div>

      <div class="top-actions">
        <button class="btn-ghost" onclick="copyKey()">Copy Key</button>
        <button class="btn-ghost" onclick="window.print()">Print</button>
      </div>

      <div class="links">
        <a href="create-ticket.html">Create another ticket</a>
      </div>
    </div>
  </div>

<script>
  function loadTickets(){
    try { return JSON.parse(localStorage.getItem("ds_tickets") || "[]"); }
    catch { return []; }
  }
  function byKey(list, k){ return list.find(t => (t.key||"").trim().toUpperCase() === k.trim().toUpperCase()); }
  function fmt(dt){
    try { const d = new Date(dt); return isNaN(d) ? "" : d.toLocaleString(); }
    catch { return ""; }
  }

  // fill from URL ?key=...
  (function initFromQuery(){
    const p = new URLSearchParams(location.search);
    const k = p.get("key");
    if(k){ document.getElementById("key").value = k; lookup(); }
  })();

  async function pasteFromClipboard(){
    const msg = document.getElementById("msg");
    try{
      const text = await navigator.clipboard.readText();
      if(text){ document.getElementById("key").value = text.trim(); msg.textContent = "Pasted key."; msg.className = "note ok"; }
      else { msg.textContent = "Clipboard is empty."; msg.className = "note err"; }
    }catch{
      msg.textContent = "Clipboard access denied by browser."; msg.className = "note err";
    }
  }

  function copyKey(){
    const text = document.getElementById("v_key").textContent;
    navigator.clipboard.writeText(text).then(()=>{
      const msg = document.getElementById("msg");
      msg.textContent = "Key copied.";
      msg.className = "note ok";
    });
  }

  function lookup(e){
    if(e) e.preventDefault();
    const msg = document.getElementById("msg");
    const ticketBox = document.getElementById("ticket");
    ticketBox.style.display = "none";
    msg.textContent = "";
    msg.className = "note";

    const key = document.getElementById("key").value.trim();
    if(!key){
      msg.textContent = "Enter your Authorization Key.";
      msg.className = "note err";
      return;
    }

    const list = loadTickets();
    const t = byKey(list, key);
    if(!t){
      msg.textContent = "No ticket found for that key.";
      msg.className = "note err";
      return;
    }

    // render
    document.getElementById("v_key").textContent = t.key || "";
    document.getElementById("v_status").textContent = t.status || "Open";
    document.getElementById("v_created").textContent = fmt(t.createdAt) || "—";
    document.getElementById("v_topic").textContent = t.topic || "—";
    document.getElementById("v_user").textContent = t.username || "—";
    document.getElementById("v_subject").textContent = t.subject || "—";
    document.getElementById("v_desc").textContent = t.description || "—";

    ticketBox.style.display = "block";
    msg.textContent = "Ticket loaded.";
    msg.className = "note ok";
  }
</script>
</body>
</html>
