<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Delta Silence • Create Anonymous Ticket</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0d10; --panel:#12151a; --muted:#9aa3ad; --border:#1e2228; --accent:#00bcd4;
    --ok:#00d38a; --err:#ff8b8b; --radius:16px; --shadow:0 18px 40px rgba(0,0,0,.55);
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    background: radial-gradient(1200px 700px at 50% -250px,#16202a,#0b0d10);
    color:#fff; font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; font-weight:800;
    padding:24px;
  }
  .wrap{
    width:100%; max-width:720px; background:linear-gradient(180deg,#151a22 0%,#12151a 100%);
    border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:26px;
  }
  h1{margin:0 0 6px; font-size:clamp(1.6rem,3.2vw,2.3rem)}
  p.sub{margin:0 0 18px; color:var(--muted); font-weight:700; font-size:.95rem}
  form{display:grid; gap:14px}
  label{font-size:.95rem; margin-bottom:6px; display:block}
  input, select, textarea{
    width:100%; border:1px solid var(--border); background:#0f1318; color:#dfe6ee;
    border-radius:12px; padding:12px 14px; font-weight:700;
  }
  textarea{min-height:140px; resize:vertical}
  .row{display:grid; gap:14px; grid-template-columns:1fr 1fr}
  .btn{
    margin-top:6px; display:inline-block; padding:12px 16px; border-radius:12px;
    background:var(--accent); color:#00222a; border:none; cursor:pointer;
    font-weight:900; letter-spacing:.3px;
  }
  .btn:hover{filter:brightness(1.08)}
  .note{color:var(--muted); font-size:.85rem; margin-top:8px}
  .ok{color:var(--ok)}
  .err{color:var(--err)}
  .success{
    display:none; margin-top:14px; padding:16px; border:1px dashed var(--border); border-radius:12px; background:#0f1318;
  }
  .key{
    display:inline-flex; align-items:center; gap:10px; margin:8px 0 6px;
    padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:#0b1218;
    font-size:1.05rem;
  }
  .linkish{color:#7dd3fc; text-decoration:underline; cursor:pointer}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Create Anonymous Ticket</h1>
    <p class="sub">Fill this out to generate a private ticket. Keep the Authorization Key safe—it's the only way to view it later.</p>

    <form id="ticketForm">
      <div>
        <label for="topic">Topic</label>
        <select id="topic" required>
          <option value="">Select a topic</option>
          <option>Account / Enforcement</option>
          <option>Technical</option>
          <option>Gameplay</option>
          <option>Other</option>
        </select>
      </div>

      <div class="row">
        <div>
          <label for="username">Username</label>
          <input id="username" placeholder="e.g. SilentPlayer" required>
        </div>
        <div>
          <label for="subject">Subject</label>
          <input id="subject" placeholder="Short title" required>
        </div>
      </div>

      <div>
        <label for="description">Description</label>
        <textarea id="description" placeholder="Explain what's going on..." required></textarea>
      </div>

      <button class="btn" type="submit">Submit Ticket</button>
      <div id="status" class="note"></div>
    </form>

    <div id="successBox" class="success">
      <div>✅ Ticket created successfully!</div>
      <div style="margin-top:6px;">Your Authorization Key:</div>
      <div class="key"><span id="authKey">TCK-XXXX-XXXX</span>
        <button class="btn" id="copyBtn" type="button" style="padding:8px 10px;">Copy</button>
      </div>
      <div class="note">Save this key. You’ll need it to view the ticket later.</div>
      <div class="note" style="margin-top:10px;">
        When we build the viewer, you’ll go to
        <span class="linkish" id="futureLink">view-ticket.html?key=…</span>
      </div>
    </div>
  </div>

<script>
  // ---- helpers ----
  function generateKey() {
    const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789"; // no 0/O/1/I to avoid confusion
    let key = "TCK-";
    for (let i = 0; i < 8; i++) {
      key += chars[Math.floor(Math.random() * chars.length)];
      if (i === 3) key += "-";
    }
    return key;
  }
  function nowISO(){ return new Date().toISOString(); }

  function sanitize(str){
    return (str || "").toString().trim().slice(0, 4000);
  }

  function loadTickets(){
    try {
      return JSON.parse(localStorage.getItem("ds_tickets") || "[]");
    } catch { return []; }
  }
  function saveTickets(list){
    localStorage.setItem("ds_tickets", JSON.stringify(list));
  }

  // ---- main ----
  const form = document.getElementById("ticketForm");
  const statusEl = document.getElementById("status");
  const successBox = document.getElementById("successBox");
  const keyEl = document.getElementById("authKey");
  const copyBtn = document.getElementById("copyBtn");
  const futureLink = document.getElementById("futureLink");

  form.addEventListener("submit", (e)=>{
    e.preventDefault();
    statusEl.textContent = "";
    statusEl.className = "note";

    const topic = sanitize(document.getElementById("topic").value);
    const username = sanitize(document.getElementById("username").value);
    const subject = sanitize(document.getElementById("subject").value);
    const description = sanitize(document.getElementById("description").value);

    if(!topic || !username || !subject || !description){
      statusEl.textContent = "Please fill all fields.";
      statusEl.className = "note err";
      return;
    }

    const key = generateKey();
    const ticket = {
      key,
      topic,
      username,
      subject,
      description,
      status: "Open",
      createdAt: nowISO()
    };

    const list = loadTickets();
    list.push(ticket);
    saveTickets(list);

    // show success
    keyEl.textContent = key;
    futureLink.textContent = `view-ticket.html?key=${encodeURIComponent(key)}`;
    successBox.style.display = "block";

    // reset form
    form.reset();
    statusEl.textContent = "Saved locally.";
    statusEl.className = "note ok";
  });

  copyBtn.addEventListener("click", async ()=>{
    const text = keyEl.textContent;
    try {
      await navigator.clipboard.writeText(text);
      copyBtn.textContent = "Copied!";
      setTimeout(()=>copyBtn.textContent="Copy", 1200);
    } catch {
      copyBtn.textContent = "Unable to copy";
      setTimeout(()=>copyBtn.textContent="Copy", 1200);
    }
  });
</script>
</body>
</html>
